version: '3.8'

# Complete Nika Project Stack with Frontend, Backend API, and SQLite Database
# Frontend is built locally and copied to container, Backend can access frontend files via shared volume
# Usage:
#   docker compose up -d    # Start all services
#   docker compose down     # Stop all services
#   docker compose logs     # View logs
#
# Services:
#   - frontend: Pre-built React app served by nginx on port 8080
#   - server: Node.js Express API server on port 3001 (internal) with access to frontend files
#   - db-data: Persistent SQLite database volume
#   - frontend-static: Shared volume for frontend static files

services:
  # Frontend service (React app served by nginx)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nika-project-frontend
    restart: unless-stopped
    ports:
      - "8080:80"
    environment:
      - NODE_ENV=production
    networks:
      - app-network
    depends_on:
      - server

  # Backend API server
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: nika-project-server
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
    volumes:
      - db-data:/app/data
    networks:
      - app-network

volumes:
  db-data:
    driver: local

networks:
  app-network:
    driver: bridge
